{"version":3,"file":"sse.handler.js","sourceRoot":"","sources":["../../../src/service/sse.handler.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,kBAAkB,CAAC;AAE9C;;GAEG;AACH,MAAM,OAAO,UAAU;IAIrB;;;;;OAKG;IACH,YAAY,SAAiB,EAAE,OAAe;QAC5C,MAAM,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;QAClC,IAAI,CAAC,GAAG,GAAG,IAAI,WAAW,CAAC,SAAS,GAAG,MAAM,EAAE,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAC;QAE1E,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,KAAmB,EAAE,EAAE;YACxC,OAAO,CAAC,KAAK,CAAC,sBAAsB,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAC9D,CAAC,CAAC;QACF,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,KAAmB,EAAE,EAAE;YACpD,OAAO,CAAC,KAAK,CAAC,qCAAqC,CAAC,CAAC;QACvD,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,KAAmB,EAAE,EAAE;YACzC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;YACtC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACrB,CAAC,CAAC;IACJ,CAAC;IAED;;;;;;;;;OASG;IACI,gBAAgB,CAAC,IAAY,EAAE,QAA4C;QAChF,OAAO,CAAC,KAAK,CAAC,uBAAuB,GAAG,IAAI,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC5C,CAAC;IAEM,mBAAmB,CAAC,IAAY,EAAE,QAA4C;QACnF,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC/C,CAAC;CAEF","sourcesContent":["import { makeSseUrl } from \"@hb42/lib-common\";\n\n/**\n * Auf SSE Events reagieren\n */\nexport class SseHandler {\n\n  private sse: EventSource;\n\n  /**\n   * EventSource fuer den Empfang von Server Sent Events erzeugen\n   *\n   * @param serverUrl - Server-Adresse\n   * @param sseAddr - SSE-Aufruf (wird intern auf /sse/<sseAddr> umgesetzt)\n   */\n  constructor(serverUrl: string, sseAddr: string) {\n    const sseUrl = makeSseUrl(\"farc\");\n    this.sse = new EventSource(serverUrl + sseUrl, { withCredentials: true });\n\n    this.sse.onopen = (event: MessageEvent) => {\n      console.debug(\"SSE open readystate=\" + this.sse.readyState);\n    };\n    this.addEventListener(\"init\", (event: MessageEvent) => {\n      console.debug(\"SSE received initialization message\");\n    });\n    this.sse.onerror = (event: MessageEvent) => {\n      console.error(\"EventSource failed. \");\n      console.dir(event);\n    };\n  }\n\n  /**\n   * Listener fuer SSE Events anhaengen\n   *\n   *   event.lastEventId -> id\n   *   event.type -> event\n   *   event.data -> data\n   *\n   * @param type - Name des Event\n   * @param listener - Listener-Funktion -> (event) => {}\n   */\n  public addEventListener(type: string, listener: EventListenerOrEventListenerObject) {\n    console.debug(\"SSE addEventListener \" + type);\n    this.sse.addEventListener(type, listener);\n  }\n\n  public removeEventListener(type: string, listener: EventListenerOrEventListenerObject) {\n    this.sse.removeEventListener(type, listener);\n  }\n\n}\n"]}