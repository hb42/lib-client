{"version":3,"file":"sse.handler.js","sourceRoot":"","sources":["../../../src/service/sse.handler.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,kBAAkB,CAAC;AAE9C;;GAEG;AACH,MAAM,OAAO,UAAU;IAIrB;;;;;OAKG;IACH,YAAY,SAAiB,EAAE,OAAe;QAC5C,MAAM,MAAM,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;QAClC,IAAI,CAAC,GAAG,GAAG,IAAI,WAAW,CAAC,SAAS,GAAG,MAAM,EAAE,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAC;QAE1E,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,KAAmB,EAAE,EAAE;YACxC,OAAO,CAAC,KAAK,CAAC,sBAAsB,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAC9D,CAAC,CAAC;QACF,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC,KAAmB,EAAE,EAAE;YACpD,OAAO,CAAC,KAAK,CAAC,qCAAqC,CAAC,CAAC;QACvD,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,KAAmB,EAAE,EAAE;YACzC,OAAO,CAAC,KAAK,CAAC,sBAAsB,CAAC,CAAC;YACtC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACrB,CAAC,CAAC;IACJ,CAAC;IAED;;;;;;;;;OASG;IACI,gBAAgB,CAAC,IAAY,EAAE,QAA4C;QAChF,OAAO,CAAC,KAAK,CAAC,uBAAuB,GAAG,IAAI,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC5C,CAAC;IAEM,mBAAmB,CAAC,IAAY,EAAE,QAA4C;QACnF,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC/C,CAAC;CAEF","sourcesContent":["import { makeSseUrl } from \"@hb42/lib-common\";\r\n\r\n/**\r\n * Auf SSE Events reagieren\r\n */\r\nexport class SseHandler {\r\n\r\n  private sse: EventSource;\r\n\r\n  /**\r\n   * EventSource fuer den Empfang von Server Sent Events erzeugen\r\n   *\r\n   * @param serverUrl - Server-Adresse\r\n   * @param sseAddr - SSE-Aufruf (wird intern auf /sse/<sseAddr> umgesetzt)\r\n   */\r\n  constructor(serverUrl: string, sseAddr: string) {\r\n    const sseUrl = makeSseUrl(\"farc\");\r\n    this.sse = new EventSource(serverUrl + sseUrl, { withCredentials: true });\r\n\r\n    this.sse.onopen = (event: MessageEvent) => {\r\n      console.debug(\"SSE open readystate=\" + this.sse.readyState);\r\n    };\r\n    this.addEventListener(\"init\", (event: MessageEvent) => {\r\n      console.debug(\"SSE received initialization message\");\r\n    });\r\n    this.sse.onerror = (event: MessageEvent) => {\r\n      console.error(\"EventSource failed. \");\r\n      console.dir(event);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Listener fuer SSE Events anhaengen\r\n   *\r\n   *   event.lastEventId -> id\r\n   *   event.type -> event\r\n   *   event.data -> data\r\n   *\r\n   * @param type - Name des Event\r\n   * @param listener - Listener-Funktion -> (event) => {}\r\n   */\r\n  public addEventListener(type: string, listener: EventListenerOrEventListenerObject) {\r\n    console.debug(\"SSE addEventListener \" + type);\r\n    this.sse.addEventListener(type, listener);\r\n  }\r\n\r\n  public removeEventListener(type: string, listener: EventListenerOrEventListenerObject) {\r\n    this.sse.removeEventListener(type, listener);\r\n  }\r\n\r\n}\r\n"]}