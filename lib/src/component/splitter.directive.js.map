{"version":3,"file":"splitter.directive.js","sourceRoot":"","sources":["../../../src/component/splitter.directive.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Attribut fb-splitter\n *\n * Splitter fuer Flexbox\n *\n * Die Voraussetzung ist, dass das Parent-Element mit display:flex ausgezeichnet ist.\n * Die Splitterausrichtung wird von der flexDirection-Eigenschaft des Parent abgeleitet\n * (\"row\" horizontaler Splitter, \"column\" vertikal).\n * Der Splitter muss zwischen den beiden Element plaziert werden, die veraendert werden\n * sollen, \"order\" funktioniert hier nicht. Mindestens eines der Elemente muss eine feste\n * Breite/Hoehe haben (flexGrow:0, bzw flex:0 0 auto + width:/height: XXpx). Sinnvoll\n * ist zudem min-width bzw. min-height. Das zweite Element kann flex:1 bzw. flex:auto\n * bekommen, dann kuemmert sich Flexbox ums Anpassen.\n *\n * Das parent-Element braucht ausserdem den Style \"align-items: stretch\" (ist default).\n * Damit overflow im inneren DIV funktioniert muessen die Flexbox-Items position:relative\n * und der innere DIV position:absolute bekommen.\n *\n * inputs: [storageId]  - Kennung fuer die Splitterposition in der localStorage\n *                        (leer -> nicht speichern)\n *\n * Quelle:\n * https://hacks.mozilla.org/2013/12/application-layout-with-css3-flexible-box-module/\n */\n\nimport {\n    Directive,\n    ElementRef,\n    Input,\n    OnInit,\n} from \"@angular/core\";\n\n@Directive({\n  selector: \"[fb-splitter]\",\n})\nexport class FlexboxSplitter implements OnInit {\n\n  public static SPLITTER_EVENT: string = \"hbsplitter\";\n\n  // inputs\n  @Input() private storageId: string = \"\";\n\n  private splitter: HTMLElement;\n  private prevEl: HTMLElement;\n  private nextEl: HTMLElement;\n  private dimension: string;\n  // private chgPrev: boolean = false;\n  // private chgNext: boolean = false;\n\n  private splitterEvent: CustomEvent;\n\n  private lastPos: number = 0;\n\n  constructor(private el: ElementRef) {\n    console.debug(\"c'tor flexboxsplitter\");\n    this.splitter = el.nativeElement;\n  }\n\n  public ngOnInit() {\n    // Umgebung holen\n    this.prevEl = this.splitter.previousElementSibling as HTMLElement;\n    this.nextEl = this.splitter.nextElementSibling as HTMLElement;\n    const parent: Element = this.splitter.parentElement as Element;\n    // parent muss flexbox sein\n    // if (this.getProp(parent, \"display\") !== \"flex\") {\n    //   throw \"Error: parent element for splitter must have style display:flex.\";\n    // }\n    // Richtung festlegen und passende Styles fuer den Splitter\n    if (this.getProp(parent, \"flexDirection\") === \"row\") {\n      this.dimension = \"width\";\n      this.splitter.style[\"border-left\" as any] = \"1px solid gray\";\n      this.splitter.style[\"cursor\"] = \"col-resize\";\n    } else {\n      this.dimension = \"height\";\n      this.splitter.style[\"border-top\" as any] = \"1px solid gray\";\n      this.splitter.style[\"cursor\"] = \"row-resize\";\n    }\n    this.splitter.style[\"background\"] = \"#eee\";\n    this.splitter.style[this.dimension as any] = \"6px\";\n\n    // Elemente nur fuer fixe Groesse aendern, flexGrow >0 = auto\n    // this.chgPrev = this.getProp(this.prevEl, \"flexGrow\") === 0;\n    // this.chgNext = this.getProp(this.nextEl, \"flexGrow\") === 0;\n    // los geht\"s\n    this.initSplitter();\n  }\n\n  private getProp(elem: Element, prop: string): any {\n    // window.getComputedStyle(elem).getPropertyValue(prop);\n    // im *IE* fkt. getPropertyValue() nicht, alt. direkter Zugriff mit [\"prop\"]\n    return window.getComputedStyle(elem)[prop as any];\n  }\n\n  private initSplitter() {\n    // let self: FlexboxSplitter = this;\n\n    // var event = new Event(\"hb.splitter\"); fkt. leider nicht im *IE*, statt dessen:\n    const params: any = { bubbles: false, cancelable: false, detail: undefined };\n    this.splitterEvent = document.createEvent(\"CustomEvent\");\n    this.splitterEvent\n        .initCustomEvent(FlexboxSplitter.SPLITTER_EVENT, params.bubbles, params.cancelable, params.detail);\n\n    const drag = (evt: DragEvent) => {\n      this.dimension === \"width\" ? calcSize(evt.clientX) : calcSize(evt.clientY);\n    };\n\n    const calcSize = (pos: number) => {\n      let newsize: number;\n      const diff: number = pos - this.lastPos;\n      // if (self.chgPrev) {\n      newsize = parseInt(this.getProp(this.prevEl, this.dimension), 10) + diff;\n      this.prevEl.style[this.dimension as any] = newsize + \"px\";\n      // }\n      // if (self.chgNext) {\n      newsize = parseInt(this.getProp(this.nextEl, this.dimension), 10) - diff;\n      this.nextEl.style[this.dimension as any] = newsize + \"px\";\n      // }\n      this.lastPos = pos;\n    };\n    const endDrag = () => {\n      window.removeEventListener(\"mousemove\", drag);\n      window.removeEventListener(\"mouseup\", endDrag);\n\n      // element bekommt list of listener als callbacks bei Aend\n      // foreach listener listener()\n      // -> Bsp eventService\n\n      // fkt. nicht\n      // var evt = document.createEvent(\"UIEvent\");\n      // evt.initUIEvent(\"resize\", true, false,window,0);\n      // window.dispatchEvent(evt);\n\n      window.dispatchEvent(this.splitterEvent);\n\n      // import f. jquery??\n      // $(window).resize();\n\n      if (this.storageId) {\n        localStorage.setItem(this.storageId, this.lastPos.toString(10));\n      }\n    };\n\n    this.splitter.addEventListener(\"mousedown\", (evt: DragEvent) => {\n      evt.preventDefault();    // prevent text selection\n      this.lastPos = this.dimension === \"width\" ? evt.clientX : evt.clientY;\n      window.addEventListener(\"mousemove\", drag);\n      window.addEventListener(\"mouseup\", endDrag);\n    });\n\n    // default pos setzen, oder ggf. letzten Stand holen\n    this.lastPos = this.dimension === \"width\" ? this.splitter.getBoundingClientRect().left\n        : this.splitter.getBoundingClientRect().top;\n    if (this.storageId) {\n      const state = localStorage.getItem(this.storageId);\n      const laststate = parseInt(state ? state : \"0\", 10);\n      if (laststate) {\n        calcSize(laststate);\n      }\n    }\n  }\n\n}\n"]}